// Correção do HTML inicial da primeira questão
// Alternativas para a questão 1 (modelo para copiar para o arquivo provas.html)
<div class="grid grid-cols-1 gap-3">
    <div>
        <label class="block text-sm font-medium text-gray-700">Alternativa A</label>
        <div class="flex items-center mt-1">
            <input type="radio" name="correctAnswer1" value="A" class="correct-option mr-2" required>
            <input type="text" class="option-text block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
        </div>
    </div>
    <div>
        <label class="block text-sm font-medium text-gray-700">Alternativa B</label>
        <div class="flex items-center mt-1">
            <input type="radio" name="correctAnswer1" value="B" class="correct-option mr-2">
            <input type="text" class="option-text block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
        </div>
    </div>
    <div>
        <label class="block text-sm font-medium text-gray-700">Alternativa C</label>
        <div class="flex items-center mt-1">
            <input type="radio" name="correctAnswer1" value="C" class="correct-option mr-2">
            <input type="text" class="option-text block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
        </div>
    </div>
    <div>
        <label class="block text-sm font-medium text-gray-700">Alternativa D</label>
        <div class="flex items-center mt-1">
            <input type="radio" name="correctAnswer1" value="D" class="correct-option mr-2">
            <input type="text" class="option-text block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
        </div>
    </div>
    <div>
        <label class="block text-sm font-medium text-gray-700">Alternativa E</label>
        <div class="flex items-center mt-1">
            <input type="radio" name="correctAnswer1" value="E" class="correct-option mr-2">
            <input type="text" class="option-text block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
        </div>
    </div>
</div>

// Correção da função addQuestionBtn.addEventListener
addQuestionBtn.addEventListener('click', function() {
    const questionsContainer = document.getElementById('questionsContainer');
    const questionItems = questionsContainer.querySelectorAll('.question-item');
    const questionCount = questionItems.length;
    
    // Habilitar botões de remoção para todas as questões
    questionItems.forEach(item => {
        item.querySelector('.removeQuestion').classList.remove('hidden');
    });
    
    const newQuestionNumber = questionCount + 1;
    
    const newQuestionDiv = document.createElement('div');
    newQuestionDiv.className = 'question-item bg-gray-50 p-4 rounded-md';
    newQuestionDiv.innerHTML = `
        <div class="flex justify-between items-center mb-2">
            <h4 class="text-md font-medium">Questão ${newQuestionNumber}</h4>
            <button type="button" class="text-red-500 hover:text-red-700 removeQuestion">
                <i class="fas fa-trash"></i>
            </button>
        </div>
        <div class="space-y-3">
            <div>
                <label class="block text-sm font-medium text-gray-700">Enunciado</label>
                <textarea class="question-text mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" rows="2" required></textarea>
            </div>
            
            <!-- Imagem da questão -->
            <div>
                <label class="block text-sm font-medium text-gray-700">Imagem (opcional)</label>
                <div class="mt-1 flex items-center">
                    <input type="file" accept="image/*" class="question-image block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                </div>
                <div class="mt-2 image-preview hidden">
                    <img src="" alt="Preview" class="max-h-48 rounded">
                    <button type="button" class="remove-image mt-1 text-xs text-red-600 hover:text-red-900">
                        <i class="fas fa-times mr-1"></i> Remover imagem
                    </button>
                </div>
            </div>
            
            <!-- Metadados da questão -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-gray-50 rounded-md">
                <div>
                    <label class="block text-sm font-medium text-gray-700">Nível de ensino</label>
                    <select class="education-level mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                        <option value="">Selecione</option>
                        <option value="Infantil">Educação Infantil</option>
                        <option value="Fundamental Anos Iniciais">Fundamental Anos Iniciais</option>
                        <option value="Fundamental Anos Finais">Fundamental Anos Finais</option>
                        <option value="Ensino Médio">Ensino Médio</option>
                        <option value="EJA">EJA</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Série</label>
                    <select class="grade-level mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                        <option value="">Selecione</option>
                        <option value="1º Ano">1º Ano</option>
                        <option value="2º Ano">2º Ano</option>
                        <option value="3º Ano">3º Ano</option>
                        <option value="4º Ano">4º Ano</option>
                        <option value="5º Ano">5º Ano</option>
                        <option value="6º Ano">6º Ano</option>
                        <option value="7º Ano">7º Ano</option>
                        <option value="8º Ano">8º Ano</option>
                        <option value="9º Ano">9º Ano</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Dificuldade</label>
                    <select class="difficulty-level mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                        <option value="">Selecione</option>
                        <option value="Fácil">Fácil</option>
                        <option value="Médio">Médio</option>
                        <option value="Difícil">Difícil</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Componente curricular</label>
                    <select class="curriculum-component mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                        <option value="">Selecione</option>
                        <option value="Língua Portuguesa">Língua Portuguesa</option>
                        <option value="Matemática">Matemática</option>
                        <option value="Ciências">Ciências</option>
                        <option value="História">História</option>
                        <option value="Geografia">Geografia</option>
                        <option value="Educação Física">Educação Física</option>
                        <option value="Arte">Arte</option>
                        <option value="Inglês">Inglês</option>
                    </select>
                </div>
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700">Habilidades BNCC</label>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">
                            Habilidades BNCC <span class="selected-skills-count text-gray-500 text-xs"></span>
                        </label>
                        <div class="border border-gray-300 rounded-md p-2 bg-white relative">
                            <div class="selected-skills-list space-y-1 mb-2"></div>
                            <button type="button" class="select-bncc-btn w-full py-2 px-3 border border-gray-300 bg-gray-100 rounded-md text-sm text-left text-gray-700 hover:bg-gray-200 focus:outline-none">
                                <i class="fas fa-plus-circle mr-2"></i> Selecionar habilidades BNCC
                            </button>
                            <input type="hidden" class="bncc-codes-input">
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="grid grid-cols-1 gap-3">
                <div>
                    <label class="block text-sm font-medium text-gray-700">Alternativa A</label>
                    <div class="flex items-center mt-1">
                        <input type="radio" name="correctAnswer${newQuestionNumber}" value="A" class="correct-option mr-2" required>
                        <input type="text" class="option-text block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Alternativa B</label>
                    <div class="flex items-center mt-1">
                        <input type="radio" name="correctAnswer${newQuestionNumber}" value="B" class="correct-option mr-2">
                        <input type="text" class="option-text block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Alternativa C</label>
                    <div class="flex items-center mt-1">
                        <input type="radio" name="correctAnswer${newQuestionNumber}" value="C" class="correct-option mr-2">
                        <input type="text" class="option-text block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Alternativa D</label>
                    <div class="flex items-center mt-1">
                        <input type="radio" name="correctAnswer${newQuestionNumber}" value="D" class="correct-option mr-2">
                        <input type="text" class="option-text block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Alternativa E</label>
                    <div class="flex items-center mt-1">
                        <input type="radio" name="correctAnswer${newQuestionNumber}" value="E" class="correct-option mr-2">
                        <input type="text" class="option-text block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    questionsContainer.appendChild(newQuestionDiv);
    
    // Adicionar evento para remover questão
    newQuestionDiv.querySelector('.removeQuestion').addEventListener('click', function() {
        removeQuestion(newQuestionDiv);
    });
    
    // Configurar upload de imagem para a nova questão
    setupImageUploads();
    
    // Configurar botões BNCC para a nova questão
    newQuestionDiv.querySelector('.select-bncc-btn').addEventListener('click', openBnccSelector);
    
    // Rolar para a nova questão
    newQuestionDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
});

// Correção da função addQuestionToForm
function addQuestionToForm(questionData) {
    const questionsContainer = document.getElementById('questionsContainer');
    const questionCount = questionsContainer.querySelectorAll('.question-item').length;
    const newQuestionNumber = questionCount + 1;
    
    const newQuestionDiv = document.createElement('div');
    newQuestionDiv.className = 'question-item bg-gray-50 p-4 rounded-md mt-4';
    
    // Criar o HTML básico para a questão
    newQuestionDiv.innerHTML = `
        <div class="flex justify-between items-center mb-2">
            <h4 class="text-md font-medium">Questão ${newQuestionNumber}</h4>
            <button type="button" class="text-red-500 hover:text-red-700 removeQuestion">
                <i class="fas fa-trash"></i>
            </button>
        </div>
        <div class="space-y-3">
            <div>
                <label class="block text-sm font-medium text-gray-700">Enunciado</label>
                <textarea class="question-text mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" rows="2" required>${questionData ? questionData.text : ''}</textarea>
            </div>
            
            <!-- Imagem da questão -->
            <div>
                <label class="block text-sm font-medium text-gray-700">Imagem (opcional)</label>
                <div class="mt-1 flex items-center">
                    <input type="file" accept="image/*" class="question-image block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                </div>
                <div class="mt-2 image-preview ${questionData && questionData.image ? '' : 'hidden'}">
                    <img src="${questionData && questionData.image ? questionData.image : ''}" alt="Preview" class="max-h-48 rounded">
                    <button type="button" class="remove-image mt-1 text-xs text-red-600 hover:text-red-900">
                        <i class="fas fa-times mr-1"></i> Remover imagem
                    </button>
                </div>
            </div>
            
            <!-- Metadados da questão -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-gray-50 rounded-md">
                <div>
                    <label class="block text-sm font-medium text-gray-700">Nível de ensino</label>
                    <select class="education-level mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                        <option value="">Selecione</option>
                        <option value="Infantil" ${questionData && questionData.metadata && questionData.metadata.educationLevel === 'Infantil' ? 'selected' : ''}>Educação Infantil</option>
                        <option value="Fundamental Anos Iniciais" ${questionData && questionData.metadata && questionData.metadata.educationLevel === 'Fundamental Anos Iniciais' ? 'selected' : ''}>Fundamental Anos Iniciais</option>
                        <option value="Fundamental Anos Finais" ${questionData && questionData.metadata && questionData.metadata.educationLevel === 'Fundamental Anos Finais' ? 'selected' : ''}>Fundamental Anos Finais</option>
                        <option value="Ensino Médio" ${questionData && questionData.metadata && questionData.metadata.educationLevel === 'Ensino Médio' ? 'selected' : ''}>Ensino Médio</option>
                        <option value="EJA" ${questionData && questionData.metadata && questionData.metadata.educationLevel === 'EJA' ? 'selected' : ''}>EJA</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Série</label>
                    <select class="grade-level mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                        <option value="">Selecione</option>
                        <option value="1º Ano" ${questionData && questionData.metadata && questionData.metadata.gradeLevel === '1º Ano' ? 'selected' : ''}>1º Ano</option>
                        <option value="2º Ano" ${questionData && questionData.metadata && questionData.metadata.gradeLevel === '2º Ano' ? 'selected' : ''}>2º Ano</option>
                        <option value="3º Ano" ${questionData && questionData.metadata && questionData.metadata.gradeLevel === '3º Ano' ? 'selected' : ''}>3º Ano</option>
                        <option value="4º Ano" ${questionData && questionData.metadata && questionData.metadata.gradeLevel === '4º Ano' ? 'selected' : ''}>4º Ano</option>
                        <option value="5º Ano" ${questionData && questionData.metadata && questionData.metadata.gradeLevel === '5º Ano' ? 'selected' : ''}>5º Ano</option>
                        <option value="6º Ano" ${questionData && questionData.metadata && questionData.metadata.gradeLevel === '6º Ano' ? 'selected' : ''}>6º Ano</option>
                        <option value="7º Ano" ${questionData && questionData.metadata && questionData.metadata.gradeLevel === '7º Ano' ? 'selected' : ''}>7º Ano</option>
                        <option value="8º Ano" ${questionData && questionData.metadata && questionData.metadata.gradeLevel === '8º Ano' ? 'selected' : ''}>8º Ano</option>
                        <option value="9º Ano" ${questionData && questionData.metadata && questionData.metadata.gradeLevel === '9º Ano' ? 'selected' : ''}>9º Ano</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Dificuldade</label>
                    <select class="difficulty-level mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                        <option value="">Selecione</option>
                        <option value="Fácil" ${questionData && questionData.metadata && questionData.metadata.difficultyLevel === 'Fácil' ? 'selected' : ''}>Fácil</option>
                        <option value="Médio" ${questionData && questionData.metadata && questionData.metadata.difficultyLevel === 'Médio' ? 'selected' : ''}>Médio</option>
                        <option value="Difícil" ${questionData && questionData.metadata && questionData.metadata.difficultyLevel === 'Difícil' ? 'selected' : ''}>Difícil</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Componente curricular</label>
                    <select class="curriculum-component mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                        <option value="">Selecione</option>
                        <option value="Língua Portuguesa" ${questionData && questionData.metadata && questionData.metadata.curriculumComponent === 'Língua Portuguesa' ? 'selected' : ''}>Língua Portuguesa</option>
                        <option value="Matemática" ${questionData && questionData.metadata && questionData.metadata.curriculumComponent === 'Matemática' ? 'selected' : ''}>Matemática</option>
                        <option value="Ciências" ${questionData && questionData.metadata && questionData.metadata.curriculumComponent === 'Ciências' ? 'selected' : ''}>Ciências</option>
                        <option value="História" ${questionData && questionData.metadata && questionData.metadata.curriculumComponent === 'História' ? 'selected' : ''}>História</option>
                        <option value="Geografia" ${questionData && questionData.metadata && questionData.metadata.curriculumComponent === 'Geografia' ? 'selected' : ''}>Geografia</option>
                        <option value="Educação Física" ${questionData && questionData.metadata && questionData.metadata.curriculumComponent === 'Educação Física' ? 'selected' : ''}>Educação Física</option>
                        <option value="Arte" ${questionData && questionData.metadata && questionData.metadata.curriculumComponent === 'Arte' ? 'selected' : ''}>Arte</option>
                        <option value="Inglês" ${questionData && questionData.metadata && questionData.metadata.curriculumComponent === 'Inglês' ? 'selected' : ''}>Inglês</option>
                    </select>
                </div>
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700">Habilidades BNCC</label>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">
                            Habilidades BNCC <span class="selected-skills-count text-gray-500 text-xs"></span>
                        </label>
                        <div class="border border-gray-300 rounded-md p-2 bg-white relative">
                            <div class="selected-skills-list space-y-1 mb-2"></div>
                            <button type="button" class="select-bncc-btn w-full py-2 px-3 border border-gray-300 bg-gray-100 rounded-md text-sm text-left text-gray-700 hover:bg-gray-200 focus:outline-none">
                                <i class="fas fa-plus-circle mr-2"></i> Selecionar habilidades BNCC
                            </button>
                            <input type="hidden" class="bncc-codes-input" value="${questionData && questionData.metadata && questionData.metadata.bnccCodes || ''}">
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="grid grid-cols-1 gap-3">
                <div>
                    <label class="block text-sm font-medium text-gray-700">Alternativa A</label>
                    <div class="flex items-center mt-1">
                        <input type="radio" name="correctAnswer${newQuestionNumber}" value="A" class="correct-option mr-2" ${questionData && questionData.correctAnswer === 'A' ? 'checked' : ''} required>
                        <input type="text" class="option-text block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" value="${questionData && questionData.options && questionData.options[0] ? questionData.options[0].text : ''}" required>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Alternativa B</label>
                    <div class="flex items-center mt-1">
                        <input type="radio" name="correctAnswer${newQuestionNumber}" value="B" class="correct-option mr-2" ${questionData && questionData.correctAnswer === 'B' ? 'checked' : ''}>
                        <input type="text" class="option-text block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" value="${questionData && questionData.options && questionData.options[1] ? questionData.options[1].text : ''}" required>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Alternativa C</label>
                    <div class="flex items-center mt-1">
                        <input type="radio" name="correctAnswer${newQuestionNumber}" value="C" class="correct-option mr-2" ${questionData && questionData.correctAnswer === 'C' ? 'checked' : ''}>
                        <input type="text" class="option-text block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" value="${questionData && questionData.options && questionData.options[2] ? questionData.options[2].text : ''}" required>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Alternativa D</label>
                    <div class="flex items-center mt-1">
                        <input type="radio" name="correctAnswer${newQuestionNumber}" value="D" class="correct-option mr-2" ${questionData && questionData.correctAnswer === 'D' ? 'checked' : ''}>
                        <input type="text" class="option-text block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" value="${questionData && questionData.options && questionData.options[3] ? questionData.options[3].text : ''}" required>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Alternativa E</label>
                    <div class="flex items-center mt-1">
                        <input type="radio" name="correctAnswer${newQuestionNumber}" value="E" class="correct-option mr-2" ${questionData && questionData.correctAnswer === 'E' ? 'checked' : ''}>
                        <input type="text" class="option-text block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" value="${questionData && questionData.options && questionData.options[4] ? questionData.options[4].text : ''}" required>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    questionsContainer.appendChild(newQuestionDiv);
    
    // Adicionar evento para remover questão
    newQuestionDiv.querySelector('.removeQuestion').addEventListener('click', function() {
        removeQuestion(newQuestionDiv);
    });
    
    // Configurar eventos para upload de imagens específicos para esta questão
    const imageInput = newQuestionDiv.querySelector('.question-image');
    if (imageInput) {
        // Listener para upload de imagem
        imageInput.addEventListener('change', handleImageUpload);
        imageInput.hasListener = true;
    }
    
    const removeImageBtn = newQuestionDiv.querySelector('.remove-image');
    if (removeImageBtn) {
        // Criar um handler único para este botão
        const handlerName = 'removeImage_' + Math.random().toString(36).substring(2, 9);
        window[handlerName] = function() {
            const previewContainer = this.closest('.image-preview');
            const fileInput = this.closest('.question-item').querySelector('.question-image');
            
            // Limpar o preview
            previewContainer.classList.add('hidden');
            previewContainer.querySelector('img').src = '';
            
            // Limpar o input de arquivo
            if (fileInput) fileInput.value = '';
        };
        
        removeImageBtn.addEventListener('click', window[handlerName]);
        removeImageBtn.hasListener = true;
        removeImageBtn.setAttribute('data-handler', handlerName);
    }
    
    // Verificar se há imagem para exibição em questões existentes
    if (questionData && questionData.image) {
        const previewImg = newQuestionDiv.querySelector('.image-preview img');
        if (previewImg) {
            previewImg.src = questionData.image;
            newQuestionDiv.querySelector('.image-preview').classList.remove('hidden');
        }
    }
    
    // Setup para BNCC
    const selectBnccBtn = newQuestionDiv.querySelector('.select-bncc-btn');
    if (selectBnccBtn) {
        selectBnccBtn.addEventListener('click', openBnccSelector);
    }
    
    // Se houver códigos BNCC, mostrar as habilidades selecionadas
    if (questionData && questionData.metadata && questionData.metadata.bnccCodes) {
        const bnccCodes = questionData.metadata.bnccCodes.split(',');
        const selectedSkillsList = newQuestionDiv.querySelector('.selected-skills-list');
        
        bnccCodes.forEach(codeValue => {
            const parts = codeValue.trim().split(':');
            if (parts.length >= 1) {
                const code = parts[0];
                
                const skillBadge = document.createElement('div');
                skillBadge.className = 'inline-flex items-center bg-blue-100 text-blue-800 rounded px-2 py-1 text-sm mr-2 mb-2';
                skillBadge.innerHTML = `<span>${code}</span>`;
                selectedSkillsList.appendChild(skillBadge);
            }
        });
        
        // Atualizar contador
        const countSpan = newQuestionDiv.querySelector('.selected-skills-count');
        if (countSpan) {
            countSpan.textContent = `(${bnccCodes.length})`;
        }
    }
    
    return newQuestionDiv;
} 